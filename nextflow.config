nextflow.enable.dsl = 2

manifest {
    name = 'genomic-variant-tracing'
    author = 'Genomics Pipeline'
    description = 'Complete pipeline for tracing origin of genomic variants'
    version = '1.0.0'
    nextflowVersion = '>=22.10.0'
}

params {
    // Input parameters
    reads = "data/reads/*_{1,2}.fastq.gz"
    reference = "data/reference/GRCh38.fa"
    sample_name = "sample"
    output_dir = "results"
    threads = 8
    platform = "illumina"
    
    // Ancestry analysis parameters
    K = 3
    
    // Resource parameters
    memory = '16 GB'
    time = '24h'
}

// Process-specific resource allocation
process {
    withName: FASTQC {
        cpus = 4
        memory = '4 GB'
        time = '1h'
    }
    withName: TRIMMOMATIC {
        cpus = 4
        memory = '4 GB'
        time = '2h'
    }
    withName: BWA_INDEX {
        cpus = 2
        memory = '8 GB'
        time = '2h'
    }
    withName: BWA_MEM {
        cpus = 8
        memory = '16 GB'
        time = '8h'
    }
    withName: SAMTOOLS_SORT {
        cpus = 4
        memory = '8 GB'
        time = '2h'
    }
    withName: GATK_HAPLOTYPECALLER {
        cpus = 8
        memory = '16 GB'
        time = '12h'
    }
    withName: GATK_VARIANTFILTRATION {
        cpus = 2
        memory = '4 GB'
        time = '1h'
    }
    withName: SELECT_VARIANTS {
        cpus = 2
        memory = '4 GB'
        time = '1h'
    }
    withName: VEP_ANNOTATION {
        cpus = 4
        memory = '16 GB'
        time = '8h'
    }
    withName: PLINK_CONVERSION {
        cpus = 4
        memory = '4 GB'
        time = '1h'
    }
    withName: ADMIXTURE {
        cpus = 4
        memory = '8 GB'
        time = '4h'
    }
    withName: IQTREE {
        cpus = 8
        memory = '8 GB'
        time = '8h'
    }
}

// Singularity/Apptainer configuration (optional)
singularity {
    enabled = false
    autoMounts = true
}

// Docker configuration (alternative)
docker {
    enabled = false
    runOptions = '-u $(id -u):$(id -g)'
}

// Conda configuration
conda {
    enabled = true
    cacheDir = "${params.output_dir}/.conda"
}

// Report and timeline
timeline {
    enabled = true
    file = "${params.output_dir}/timeline.html"
}

report {
    enabled = true
    file = "${params.output_dir}/report.html"
}

dag {
    enabled = true
    file = "${params.output_dir}/dag.png"
}

// Trace for debugging
trace {
    enabled = true
    file = "${params.output_dir}/trace.txt"
    fields = 'task_id,hash,process,name,status,exit,realtime,%cpu,%mem,rss'
}
